<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Ürün Açıklayıcı</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-[url('https://picsum.photos/1920/1080')] bg-cover bg-center bg-no-repeat bg-fixed min-h-screen m-0 flex items-center justify-center p-6"
  >
    <div class="bg-gray-100/50 p-6 rounded-xl shadow-2xl w-full max-w-xl">
      <h1 class="text-3xl text-black font-bold mb-4 text-center">
        🛍️ Ürününüzü AI Anlatsın!
      </h1>
      <p class="text-md text-black mb-2">
        Yapay zekâ destekli açıklamalarla ürünlerinizi saniyeler içinde
        etkileyici bir şekilde tanıtan, profesyonel metinler hazırlayın.
      </p>

      <label for="language" class="block mb-2 font-medium">Açıklama Dili:</label>
      <select id="language" class="w-full p-3 border rounded mb-4">
        <option value="tr" selected>Türkçe</option>
        <option value="en">English</option>
      </select>

      <label for="category" class="block mb-2 font-medium">Ürün Kategorisi:</label>
      <select id="category" class="w-full p-3 border rounded mb-4">
        <option value="diğer">Diğer</option>
        <option value="giyim">Giyim</option>
        <option value="ayakkabı">Ayakkabı</option>
        <option value="aksesuar">Aksesuar</option>
        <option value="elektronik">Elektronik</option>
        <option value="bilgisayar">Bilgisayar / Tablet</option>
        <option value="telefon">Telefon / Aksesuar</option>
        <option value="ev">Ev Ürünleri</option>
        <option value="mutfak">Mutfak Gereçleri</option>
        <option value="mobilya">Mobilya</option>
        <option value="dekorasyon">Dekorasyon</option>
        <option value="kozmetik">Kozmetik</option>
        <option value="kişisel bakım">Kişisel Bakım</option>
        <option value="kitap">Kitap</option>
        <option value="oyuncak">Oyuncak</option>
        <option value="bebek">Bebek Ürünleri</option>
        <option value="anne">Anne Ürünleri</option>
        <option value="spor">Spor / Outdoor</option>
        <option value="evcil">Evcil Hayvan Ürünleri</option>
        <option value="otomobil">Otomobil Aksesuarları</option>
      </select>

      <label for="length" class="block mb-2 font-medium">Açıklama Uzunluğu:</label>
      <select id="length" class="w-full p-3 border rounded mb-4">
        <option value="kısa">Kısa (1–2 cümle)</option>
        <option value="orta" selected>Orta (3–5 cümle)</option>
        <option value="uzun">Uzun (detaylı açıklama)</option>
      </select>

      <input
        id="productInput"
        type="text"
        placeholder="Ürün adını yazın..."
        class="w-full p-3 border rounded mb-4"
      />

      <!-- Ürün Açıklaması Butonu -->
      <button
        id="generateBtn"
        class="w-full bg-blue-600 text-white p-3 rounded-md hover:bg-blue-700 transition font-semibold flex items-center justify-center gap-2"
      >
        <span id="btnText">Açıklama Oluştur</span>
        <svg
          id="btnSpinner"
          class="animate-spin h-5 w-5 text-white hidden"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
          ></path>
        </svg>
      </button>

      <div
        id="result"
        class="mt-4 p-4 border rounded text-sm bg-gray-100 whitespace-pre-line hidden"
      ></div>
      <div id="descActions" class="mt-2 flex justify-center gap-2 hidden">
        <button
          id="copyBtn"
          class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm"
        >
          Kopyala
        </button>
        <button
          id="downloadDesc"
          class="bg-gray-700 hover:bg-black text-white py-1 px-3 rounded text-sm"
        >
          İndir
        </button>
      </div>

      <!-- Instagram Postu Oluştur Butonu -->
      <button
        id="generateInsta"
        class="w-full mt-4 bg-pink-600 hover:bg-pink-700 text-white font-bold p-3 rounded flex items-center justify-center gap-2"
      >
        <span id="instaBtnText">Instagram Postu Oluştur</span>
        <svg
          id="instaBtnSpinner"
          class="animate-spin h-5 w-5 text-white hidden"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
          ></path>
        </svg>
      </button>

      <div
        id="instaResult"
        class="mt-4 p-4 border rounded text-sm bg-gray-100 whitespace-pre-line hidden"
      ></div>
      <div id="instaActions" class="mt-2 flex justify-center gap-2 hidden">
        <button
          id="copyInsta"
          class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm"
        >
          Kopyala
        </button>
        <button
          id="downloadInsta"
          class="bg-gray-700 hover:bg-black text-white py-1 px-3 rounded text-sm"
        >
          İndir
        </button>
      </div>

      <!-- SEO Metni Oluştur Butonu -->
      <button
        id="generateSEO"
        class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold p-3 rounded flex items-center justify-center gap-2"
      >
        <span id="seoBtnText">SEO Metni Oluştur</span>
        <svg
          id="seoBtnSpinner"
          class="animate-spin h-5 w-5 text-white hidden"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
          ></path>
        </svg>
      </button>

      <div
        id="seoResult"
        class="mt-4 p-4 border rounded text-sm bg-gray-100 whitespace-pre-line hidden"
      ></div>
      <div id="seoActions" class="mt-2 flex justify-center gap-2 hidden">
        <button
          id="copySEO"
          class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm"
        >
          Kopyala
        </button>
        <button
          id="downloadSEO"
          class="bg-gray-700 hover:bg-black text-white py-1 px-3 rounded text-sm"
        >
          İndir
        </button>
      </div>

      <a
        href="https://www.buymeacoffee.com/enginkayalw"
        target="_blank"
        class="flex justify-center mt-6 text-center"
      >
        <img
          src="./images/yellow-button.png"
          alt="Buy Me a Coffee"
          style="height: 50px; width: auto"
        />
      </a>
    </div>

    <script>
      // Ortak indirme fonksiyonu
      function downloadText(filename, text) {
        const blob = new Blob([text], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.click();
      }

      // Loading start/stop fonksiyonları
      function startLoading(btn, textEl, spinnerEl) {
        spinnerEl.classList.remove("hidden");
        textEl.classList.add("hidden");
        btn.disabled = true;
        btn.classList.add("cursor-not-allowed", "opacity-60");
      }
      function stopLoading(btn, textEl, spinnerEl) {
        spinnerEl.classList.add("hidden");
        textEl.classList.remove("hidden");
        btn.disabled = false;
        btn.classList.remove("cursor-not-allowed", "opacity-60");
      }

      // Sistem mesajları (Türkçe ve İngilizce)
      function getSystemPrompt(type, lang) {
        const prompts = {
          tr: {
            description:
              "Sen bir e-ticaret metin yazarı AI'sısın. Kullanıcı sana bir ürün adı verecek ve sen ona kısa ama ikna edici bir ürün açıklaması yazacaksın. Dil: Türkçe.",
            insta:
              "Sen bir e-ticaret sosyal medya uzmanı AI'sın. Kullanıcının verdiği ürün bilgilerine göre etkileyici bir Instagram postu ve alakalı hashtag'ler üret. Sadece Türkçe yaz. İlk satıra Instagram post metnini yaz, ikinci satıra 'Hashtagler:' yazıp hashtag listesini sırala.",
            seo:
              "Sen bir e-ticaret SEO uzmanı AI'sın. Verilen ürün bilgilerine göre Türkçe bir SEO meta başlığı (60 karakteri geçmesin) ve ardından bir meta açıklama (150–160 karakter) üret. Şu formatı koru:\n\nMeta Title: ...\nMeta Description: ...",
          },
          en: {
            description:
              "You are an e-commerce copywriter AI. The user will give you a product name, and you will write a short but persuasive product description in English.",
            insta:
              "You are an e-commerce social media expert AI. Generate an engaging Instagram post and relevant hashtags based on the user's product information. Write only in English. Write the Instagram post text on the first line, then write 'Hashtags:' followed by the hashtag list on the second line.",
            seo:
              "You are an e-commerce SEO expert AI. Generate an English SEO meta title (max 60 characters) and a meta description (150–160 characters) based on the given product info. Use this format:\n\nMeta Title: ...\nMeta Description: ...",
          },
        };
        return prompts[lang]?.[type] || "";
      }

      // Dil bazlı alert mesajı
      function alertMessage(lang, msgTR, msgEN) {
        alert(lang === "en" ? msgEN : msgTR);
      }

      // Ortak API çağrı fonksiyonu
      async function generateContent(type) {
        const lang = document.getElementById("language").value || "tr";
        const productName = document.getElementById("productInput").value.trim();
        const category = document.getElementById("category").value || "diğer";
        const length = document.getElementById("length").value || "orta";

        if (!productName) {
          alertMessage(lang, "Lütfen ürün adını girin.", "Please enter the product name.");
          return;
        }

        // Prompt metni
        const prompt = `${lang === "tr" ? "Ürün adı" : "Product name"}: ${productName}. ${lang === "tr" ? "Kategori" : "Category"}: ${category}. ${lang === "tr" ? "Açıklama uzunluğu" : "Description length"}: ${length}.`;

        // Buton ve alanları seç
        let btn, textEl, spinner, resultEl, actionsEl;

        if (type === "description") {
          btn = generateBtn;
          textEl = btnText;
          spinner = btnSpinner;
          resultEl = document.getElementById("result");
          actionsEl = document.getElementById("descActions");
        } else if (type === "insta") {
          btn = generateInstaBtn;
          textEl = instaBtnText;
          spinner = instaBtnSpinner;
          resultEl = document.getElementById("instaResult");
          actionsEl = document.getElementById("instaActions");
        } else if (type === "seo") {
          btn = generateSEOBtn;
          textEl = seoBtnText;
          spinner = seoBtnSpinner;
          resultEl = document.getElementById("seoResult");
          actionsEl = document.getElementById("seoActions");
        }

        startLoading(btn, textEl, spinner);

        try {
          const systemContent = getSystemPrompt(type, lang);
          // SEO için prompt biraz farklı
          const userPrompt = type === "seo" ? prompt + (lang === "tr" ? " SEO başlık ve açıklama üret." : " Generate SEO title and description.") : prompt;

          const res = await fetch("/api/groq-proxy", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "llama3-8b-8192",
              messages: [
                { role: "system", content: systemContent },
                { role: "user", content: userPrompt },
              ],
            }),
          });

          if (!res.ok) throw new Error("API error");

          const data = await res.json();
          const text = data.choices?.[0]?.message?.content || (lang === "en" ? "Something went wrong 😕" : "Bir şeyler ters gitti 😕");

          resultEl.innerText = text;
          resultEl.classList.remove("hidden");
          actionsEl.classList.remove("hidden");
        } catch (error) {
          alertMessage(lang, "İstek sırasında hata oluştu.", "Error occurred during the request.");
        } finally {
          stopLoading(btn, textEl, spinner);
        }
      }

      // DOM elemanları
      const generateBtn = document.getElementById("generateBtn");
      const btnText = document.getElementById("btnText");
      const btnSpinner = document.getElementById("btnSpinner");

      const generateInstaBtn = document.getElementById("generateInsta");
      const instaBtnText = document.getElementById("instaBtnText");
      const instaBtnSpinner = document.getElementById("instaBtnSpinner");

      const generateSEOBtn = document.getElementById("generateSEO");
      const seoBtnText = document.getElementById("seoBtnText");
      const seoBtnSpinner = document.getElementById("seoBtnSpinner");

      generateBtn.addEventListener("click", () => generateContent("description"));
      generateInstaBtn.addEventListener("click", () => generateContent("insta"));
      generateSEOBtn.addEventListener("click", () => generateContent("seo"));

      // Kopyala ve indir butonları
      document.getElementById("copyBtn").addEventListener("click", () => {
        const content = document.getElementById("result").innerText;
        navigator.clipboard.writeText(content);
        alert("Açıklama kopyalandı!");
      });
      document.getElementById("downloadDesc").addEventListener("click", () => {
        const content = document.getElementById("result").innerText;
        downloadText("urun_aciklamasi.txt", content);
      });

      document.getElementById("copyInsta").addEventListener("click", () => {
        const content = document.getElementById("instaResult").innerText;
        navigator.clipboard.writeText(content);
        alert("Instagram içeriği kopyalandı!");
      });
      document.getElementById("downloadInsta").addEventListener("click", () => {
        const content = document.getElementById("instaResult").innerText;
        downloadText("instagram_icerigi.txt", content);
      });

      document.getElementById("copySEO").addEventListener("click", () => {
        const content = document.getElementById("seoResult").innerText;
        navigator.clipboard.writeText(content);
        alert("SEO metni kopyalandı!");
      });
      document.getElementById("downloadSEO").addEventListener("click", () => {
        const content = document.getElementById("seoResult").innerText;
        downloadText("seo_metni.txt", content);
      });
    </script>
  </body>
</html>
